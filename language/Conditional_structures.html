<div id="right-column">
<div aria-label="breadcrumbs navigation" role="navigation">
<ol class="breadcrumb">
<li><a href="../index.html">User Manual</a></li>
<li><a href="index.html">Language</a></li>
<li>Conditional structures</li>
</ol>
</div>
<div class="document clearer body">
<a class="reference external image-reference" href="https://www.tradingview.com/pine-script-docs/en/v5/Introduction.html"><div align="right" class="align-right"><img alt="Pine Script™ logo" height="100" src="../_images/Pine_Script_logo.svg" width="100"/></div>
</a>
<div class="section" id="conditional-structures">
<span id="pageconditionalstructures"></span><h1>Conditional structures<a class="headerlink" href="#conditional-structures" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a></li>
<li><a class="reference internal" href="#if-structure" id="id2">`if` structure</a><ul>
<li><a class="reference internal" href="#if-used-for-its-side-effects" id="id3">`if` used for its side effects</a></li>
<li><a class="reference internal" href="#if-used-to-return-a-value" id="id4">`if` used to return a value</a></li>
</ul>
</li>
<li><a class="reference internal" href="#switch-structure" id="id5">`switch` structure</a><ul>
<li><a class="reference internal" href="#switch-with-an-expression" id="id6">`switch` with an expression</a></li>
<li><a class="reference internal" href="#switch-without-an-expression" id="id7">`switch` without an expression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#matching-local-block-type-requirement" id="id8">Matching local block type requirement</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The conditional structures in Pine Script™ are <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a> and
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>. They can be used:</p>
<ul class="simple">
<li>For their side effects, i.e., when they don’t return a value but do things,
like reassign values to variables or call functions.</li>
<li>To return a value or a tuple which can then be assigned to one (or more, in the case of tuples) variable.</li>
</ul>
<p>Conditional structures, like the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_for">for</a>
and <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a> structures, can be embedded; you can use an
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a> or
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
inside another structure.</p>
<p>Some Pine Script™ built-in functions cannot be called from within the local blocks of conditional structures. They are:
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_alertcondition">alertcondition()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_barcolor">barcolor()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_fill">fill()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_hline">hline()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_indicator">indicator()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_library">library()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_plot">plot()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotbar">plotbar()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotcandle">plotcandle()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotchar">plotchar()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_plotshape">plotshape()</a>,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_strategy">strategy()</a>.
This does not entail their functionality cannot be controlled by conditions
evaluated by your script — only that it cannot be done by including them in conditional structures.
Note that while <code class="docutils literal notranslate"><span class="pre">input*.()</span></code> function calls are allowed in local blocks,
their functionality is the same as if they were in the script’s global scope.</p>
<p>The local blocks in conditional structures must be indented by four spaces or a tab.</p>
</div>
<div class="section" id="if-structure">
<span id="pageconditionalstructures-if"></span><h2><a class="toc-backref" href="#id2">`if` structure</a><a class="headerlink" href="#if-structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="if-used-for-its-side-effects">
<h3><a class="toc-backref" href="#id3">`if` used for its side effects</a><a class="headerlink" href="#if-used-for-its-side-effects" title="Permalink to this headline">¶</a></h3>
<p>An <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structure used for its side effects has the following syntax:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>if &lt;expression&gt;
    &lt;local_block&gt;
{else if &lt;expression&gt;
    &lt;local_block&gt;}
[else
    &lt;local_block&gt;]
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>Parts enclosed in square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) can appear zero or one time, and those enclosed in curly braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>) can appear zero or more times.</li>
<li>&lt;expression&gt; must be of “bool” type or be auto-castable to that type,
which is only possible for “int” or “float” values (see the <a class="reference internal" href="Type_system.html#pagetypesystem-types"><span class="std std-ref">Type system</span></a> page).</li>
<li>&lt;local_block&gt; consists of zero or more statements followed by a return value, which can be a tuple of values.
It must be indented by four spaces or a tab.</li>
<li>There can be zero or more <code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">if</span></code> clauses.</li>
<li>There can be zero or one <code class="docutils literal notranslate"><span class="pre">else</span></code> clause.</li>
</ul>
<p>When the &lt;expression&gt; following the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
evaluates to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_true">true</a>,
the first local block is executed, the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structure’s execution ends, and the value(s) evaluated at the end of the local block are returned.</p>
<p>When the &lt;expression&gt; following the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
evaluates to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_false">false</a>,
the successive <code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">if</span></code> clauses are evaluated, if there are any.
When the &lt;expression&gt; of one evaluates to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_true">true</a>,
its local block is executed, the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structure’s execution ends, and the value(s) evaluated at the end of the local block are returned.</p>
<p>When no &lt;expression&gt; has evaluated to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_true">true</a>
and an <code class="docutils literal notranslate"><span class="pre">else</span></code> clause exists, its local block is executed, the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structure’s execution ends, and the value(s) evaluated at the end of the local block are returned.</p>
<p>When no &lt;expression&gt; has evaluated to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_true">true</a>
and no <code class="docutils literal notranslate"><span class="pre">else</span></code> clause exists, <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is returned.</p>
<p>Using <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structures for their side effects can be useful to manage the order flow in strategies, for example.
While the same functionality can often be achieved using the <code class="docutils literal notranslate"><span class="pre">when</span></code> parameter in
<code class="docutils literal notranslate"><span class="pre">strategy.*()</span></code> calls, code using <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structures is easier to read:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="k">if </span><span class="p">(</span><span class="ni">ta.crossover</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span><span class="w"> </span><span class="nx">lower</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="ni">strategy.entry</span><span class="p">(</span><span class="s2">"BBandLE"</span><span class="p">,</span><span class="w"> </span><span class="ni">strategy.long</span><span class="p">,</span><span class="w"> </span><span class="nx">stop</span><span class="o">=</span><span class="nx">lower</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="nx">oca_name</span><span class="o">=</span><span class="s2">"BollingerBands"</span><span class="p">,</span><span class="w"></span>
<span class="w">                   </span><span class="nx">oca_type</span><span class="o">=</span><span class="ni">strategy.oca</span><span class="nx">.cancel</span><span class="p">,</span><span class="w"> </span><span class="nx">comment</span><span class="o">=</span><span class="s2">"BBandLE"</span><span class="p">)</span><span class="w"></span>
<span class="k">else</span>
<span class="w">    </span><span class="ni">strategy.cancel</span><span class="p">(</span><span class="nx">id</span><span class="o">=</span><span class="s2">"BBandLE"</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Restricting the execution of your code to specific bars ican be done using
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structures, as we do here to restrict updates to our label to the chart’s last bar:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>
<span class="k">var </span><span class="nx">ourLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">label.new</span><span class="p">(</span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="no">na</span><span class="p">,</span><span class="w"> </span><span class="no">na</span><span class="p">,</span><span class="w"> </span><span class="k">color </span><span class="o">=</span><span class="w"> </span><span class="ni">color</span><span class="p">(</span><span class="no">na</span><span class="p">),</span><span class="w"> </span><span class="nx">textcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">color.orange</span><span class="p">)</span><span class="w"></span>
<span class="k">if </span><span class="ni">barstate.islast</span><span class="w"></span>
<span class="w">    </span><span class="ni">label.set_xy</span><span class="p">(</span><span class="nx">ourLabel</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="no">hl2</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">label.set_text</span><span class="p">(</span><span class="nx">ourLabel</span><span class="p">,</span><span class="w"> </span><span class="ni">str.tostring</span><span class="p">(</span><span class="ni">bar_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s2">"# bars in chart"</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<p>Note that:</p>
<ul class="simple">
<li>We initialize the <code class="docutils literal notranslate"><span class="pre">ourLabel</span></code> variable on the script’s first bar only, as we use the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_var">var</a> declaration mode.
The value used to initialize the variable is provided by the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_label{dot}new">label.new()</a> function call,
which returns a label ID pointing to the label it creates.
We use that call to set the label’s properties because once set, they will persist until we change them.</li>
<li>What happens next is that on each successive bar the Pine Script™ runtime will skip the initialization of <code class="docutils literal notranslate"><span class="pre">ourLabel</span></code>,
and the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structure’s condition (<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate{dot}islast">barstate.islast</a>)
is evaluated. It returns <code class="docutils literal notranslate"><span class="pre">false</span></code> on all bars until the last one,
so the script does nothing on most historical bars after bar zero.</li>
<li>On the last bar, <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_barstate{dot}islast">barstate.islast</a>
becomes true and the structure’s local block executes,
modifying on each chart update the properties of our label, which displays the number of bars in the dataset.</li>
<li>We want to display the label’s text without a background,
so we make the label’s background <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
in the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_label{dot}new">label.new()</a> function call,
and we use <code class="docutils literal notranslate"><span class="pre">hl2[1]</span></code> for the label’s <em>y</em> position because we don’t want it to move all the time.
By using the average of the <strong>previous</strong> bar’s <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
and <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_low">low</a> values,
the label doesn’t move until the moment when the next realtime bar opens.</li>
<li>We use <code class="docutils literal notranslate"><span class="pre">bar_index</span> <span class="pre">+</span> <span class="pre">2</span></code> in our <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_label{dot}set_xy">label.set_xy()</a>
call to offset the label to the right by two bars.</li>
</ul>
</div>
<div class="section" id="if-used-to-return-a-value">
<h3><a class="toc-backref" href="#id4">`if` used to return a value</a><a class="headerlink" href="#if-used-to-return-a-value" title="Permalink to this headline">¶</a></h3>
<p>An <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
structure used to return one or more values has the following syntax:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = if &lt;expression&gt;
    &lt;local_block&gt;
{else if &lt;expression&gt;
    &lt;local_block&gt;}
[else
    &lt;local_block&gt;]
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>Parts enclosed in square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) can appear zero or one time, and those enclosed in curly braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>) can appear zero or more times.</li>
<li>&lt;declaration_mode&gt; is the variable’s <a class="reference internal" href="Variable_declarations.html#pagevariabledeclarations-declarationmodes"><span class="std std-ref">declaration mode</span></a></li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable declarations (see <a class="reference internal" href="Type_system.html#pagetypesystem-types"><span class="std std-ref">types</span></a>)</li>
<li>&lt;identifier&gt; is the variable’s <a class="reference internal" href="Identifiers.html#pageidentifiers"><span class="std std-ref">name</span></a></li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a function call.</li>
<li>&lt;local_block&gt; consists of zero or more statements followed by a return value, which can be a tuple of values.
It must be indented by four spaces or a tab.</li>
<li>The value assigned to the variable is the return value of the &lt;local_block&gt;, or
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> if no local block is executed.</li>
</ul>
<p>This is an example:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>
<span class="k">string </span><span class="nx">barState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if </span><span class="ni">barstate.islastconfirmedhistory</span><span class="w"></span>
<span class="w">    </span><span class="s2">"islastconfirmedhistory"</span><span class="w"></span>
<span class="k">else if </span><span class="ni">barstate.isnew</span><span class="w"></span>
<span class="w">    </span><span class="s2">"isnew"</span><span class="w"></span>
<span class="k">else if </span><span class="ni">barstate.isrealtime</span><span class="w"></span>
<span class="w">    </span><span class="s2">"isrealtime"</span><span class="w"></span>
<span class="k">else</span>
<span class="w">    </span><span class="s2">"other"</span><span class="w"></span>

<span class="nx">f_print</span><span class="p">(</span><span class="nx">_text</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">var table </span><span class="nx">_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">table.new</span><span class="p">(</span><span class="ni">position.middle_right</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">table.cell</span><span class="p">(</span><span class="nx">_t</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">_text</span><span class="p">,</span><span class="w"> </span><span class="ni">bgcolor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">color.yellow</span><span class="p">)</span><span class="w"></span>
<span class="nx">f_print</span><span class="p">(</span><span class="nx">barState</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>It is possible to omit the <em>else</em> block. In this case, if the <code class="docutils literal notranslate"><span class="pre">condition</span></code>
is false, an <em>empty</em> value (<code class="docutils literal notranslate"><span class="pre">na</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code>, or <code class="docutils literal notranslate"><span class="pre">""</span></code>) will be assigned to the
<code class="docutils literal notranslate"><span class="pre">var_declarationX</span></code> variable.</p>
<p>This is an example showing how
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
is returned when no local block is executed. If <code class="docutils literal notranslate"><span class="pre">close</span> <span class="pre">&gt;</span> <span class="pre">open</span></code> is <code class="docutils literal notranslate"><span class="pre">false</span></code> in here,
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is returned:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if </span><span class="no">close</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">open</span><span class="w"></span>
<span class="w">    </span><span class="no">close</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="switch-structure">
<span id="pageconditionalstructures-switch"></span><h2><a class="toc-backref" href="#id5">`switch` structure</a><a class="headerlink" href="#switch-structure" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
structure exists in two forms. One switches on the different values of a key expression:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = ]switch &lt;expression&gt;
    {&lt;expression&gt; =&gt; &lt;local_block&gt;}
    =&gt; &lt;local_block&gt;
</pre></div>
</div>
<p>The other form does not use an expression as a key; it switches on the evaluation of different expressions:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = ]switch
    {&lt;expression&gt; =&gt; &lt;local_block&gt;}
    =&gt; &lt;local_block&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>Parts enclosed in square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) can appear zero or one time, and those enclosed in curly braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>) can appear zero or more times.</li>
<li>&lt;declaration_mode&gt; is the variable’s <a class="reference internal" href="Variable_declarations.html#pagevariabledeclarations-declarationmodes"><span class="std std-ref">declaration mode</span></a></li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable declarations (see <a class="reference internal" href="Type_system.html#pagetypesystem-types"><span class="std std-ref">types</span></a>)</li>
<li>&lt;identifier&gt; is the variable’s <a class="reference internal" href="Identifiers.html#pageidentifiers"><span class="std std-ref">name</span></a></li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a function call.</li>
<li>&lt;local_block&gt; consists of zero or more statements followed by a return value, which can be a tuple of values.
It must be indented by four spaces or a tab.</li>
<li>The value assigned to the variable is the return value of the &lt;local_block&gt;, or
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> if no local block is executed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">=&gt;</span> <span class="pre">&lt;local_block&gt;</span></code> at the end allows you to specify a return value which acts as a default to be used when no other case in the structure is executed.</li>
</ul>
<p>Only one local block of a <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
structure is executed. It is thus a <em>structured switch</em> that doesn’t <em>fall through</em> cases.
Consequently, <code class="docutils literal notranslate"><span class="pre">break</span></code> statements are unnecessary.</p>
<p>Both forms are allowed as the value used to initialize a variable.</p>
<p>As with the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a> structure,
if no local block is exectuted, <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> is returned.</p>
<div class="section" id="switch-with-an-expression">
<h3><a class="toc-backref" href="#id6">`switch` with an expression</a><a class="headerlink" href="#switch-with-an-expression" title="Permalink to this headline">¶</a></h3>
<p>Let’s look at an example of a <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
using an expression:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"Switch using an expression"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>

<span class="k">string </span><span class="nx">maType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">input.string</span><span class="p">(</span><span class="s2">"EMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MA type"</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">"EMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"RMA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"WMA"</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="k">int </span><span class="nx">maLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"MA length"</span><span class="p">,</span><span class="w"> </span><span class="nx">minval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="k">float </span><span class="nx">ma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">switch </span><span class="nx">maType</span><span class="w"></span>
<span class="w">    </span><span class="s2">"EMA"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">ta.ema</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="nx">maLength</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="s2">"SMA"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="nx">maLength</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="s2">"RMA"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">ta.rma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="nx">maLength</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="s2">"WMA"</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">ta.wma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="nx">maLength</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="o">=&gt;</span><span class="w"></span>
<span class="w">        </span><span class="nx">runtime.error</span><span class="p">(</span><span class="s2">"No matching MA type found."</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="ni">float</span><span class="p">(</span><span class="no">na</span><span class="p">)</span><span class="w"></span>

<span class="ni">plot</span><span class="p">(</span><span class="nx">ma</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Note that:</p>
<ul class="simple">
<li>The expression we are switching on is the variable <code class="docutils literal notranslate"><span class="pre">maType</span></code>, which is of “input int” type
(see here for an explanation of what the “<a class="reference internal" href="Type_system.html#pagetypesystem-input"><span class="std std-ref">input</span></a>” form is).
Since it cannot change during the execution of the script, this guarantees that whichever
MA type the user selects will be executing on each bar, which is a requirement for functions like
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta{dot}ema">ta.ema()</a>
which require a “simple int” argument for their <code class="docutils literal notranslate"><span class="pre">length</span></code> parameter.</li>
<li>If no matching value is found for <code class="docutils literal notranslate"><span class="pre">maType</span></code>, the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
executes the last local block introduced by <code class="docutils literal notranslate"><span class="pre">=&gt;</span></code>, which acts as a catch-all. We generate a runtime error in that block.
We also end it with <code class="docutils literal notranslate"><span class="pre">float(na)</span></code> so the local block returns a value whose type is compatible with that of the other local blocks in the structure,
to avoid a compilation error.</li>
</ul>
</div>
<div class="section" id="switch-without-an-expression">
<h3><a class="toc-backref" href="#id7">`switch` without an expression</a><a class="headerlink" href="#switch-without-an-expression" title="Permalink to this headline">¶</a></h3>
<p>This is an example of a <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
structure wich does not use an exppression:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">strategy</span><span class="p">(</span><span class="s2">"Switch without an expression"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>

<span class="k">bool </span><span class="nx">longCondition</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="ni">ta.crossover</span><span class="p">(</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">),</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">))</span><span class="w"></span>
<span class="k">bool </span><span class="nx">shortCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">ta.crossunder</span><span class="p">(</span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">),</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">))</span><span class="w"></span>

<span class="k">switch</span>
<span class="w">    </span><span class="nx">longCondition</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">strategy.entry</span><span class="p">(</span><span class="s2">"Long ID"</span><span class="p">,</span><span class="w"> </span><span class="ni">strategy.long</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">shortCondition</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">strategy.entry</span><span class="p">(</span><span class="s2">"Short ID"</span><span class="p">,</span><span class="w"> </span><span class="ni">strategy.short</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Note that:</p>
<ul>
<li><p class="first">We are using the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
to select the appropriate strategy order to emit, depending on whether
the <code class="docutils literal notranslate"><span class="pre">longCondition</span></code> or <code class="docutils literal notranslate"><span class="pre">shortCondition</span></code> “bool” variables are <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</li>
<li><p class="first">The building conditions of <code class="docutils literal notranslate"><span class="pre">longCondition</span></code> and <code class="docutils literal notranslate"><span class="pre">shortCondition</span></code>
are exclusive. While they can both be <code class="docutils literal notranslate"><span class="pre">false</span></code> simultaneously, they cannot be <code class="docutils literal notranslate"><span class="pre">true</span></code> at the same time.
The fact that only <strong>one</strong> local block of the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a>
structure is ever executed is thus not an issue for us.</p>
</li>
<li><p class="first">We evaluate the calls to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta{dot}crossover">ta.crossover()</a>
and <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta{dot}crossunder">ta.crossunder()</a> <strong>prior</strong> to entry in the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a> structure.
Not doing so, as in the following example, would prevent the functions to be executed on each bar,
which would result in a compiler warning and erratic behavior:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">strategy</span><span class="p">(</span><span class="s2">"Switch without an expression"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>

<span class="k">switch</span>
<span class="w">    </span><span class="c">// Compiler warning! Will not calculate correctly!</span><span class="w"></span>
<span class="w">    </span><span class="ni">ta.crossover</span><span class="p">(</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">),</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">strategy.entry</span><span class="p">(</span><span class="s2">"Long ID"</span><span class="p">,</span><span class="w"> </span><span class="ni">strategy.long</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">ta.crossunder</span><span class="p">(</span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">),</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ni">strategy.entry</span><span class="p">(</span><span class="s2">"Short ID"</span><span class="p">,</span><span class="w"> </span><span class="ni">strategy.short</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="matching-local-block-type-requirement">
<span id="pageconditionalstructures-matchinglocalblocktyperequirement"></span><h2><a class="toc-backref" href="#id8">Matching local block type requirement</a><a class="headerlink" href="#matching-local-block-type-requirement" title="Permalink to this headline">¶</a></h2>
<p>When multiple local blocks are used in structures, the type of the return value of all its local blocks must match.
This is even true if the structure is not used to assign a value to a variable in a declaration,
such as when using an <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_if">if</a>
or <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_switch">switch</a> structure for its side effects only.</p>
<p>This code compiles fine because <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a>
and <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_open">open</a> are both of “float” type:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if </span><span class="no">close</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">open</span><span class="w"></span>
<span class="w">    </span><span class="no">close</span><span class="w"></span>
<span class="k">else</span>
<span class="w">    </span><span class="no">open</span><span class="w"></span>
</pre></div>
</div>
<p>This code does not compile because the first local block returns a “float” and the second one, a “string” value:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">// Compilation error!</span><span class="w"></span>
<span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if </span><span class="no">close</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">open</span><span class="w"></span>
<span class="w">    </span><span class="no">close</span><span class="w"></span>
<span class="k">else</span>
<span class="w">    </span><span class="s2">"open"</span><span class="w"></span>
</pre></div>
</div>
<p>While this makes perfect sense when using conditional structures to assign a value to a variable,
it can be inconvenient when they are used for their side effects.
To work around this limitation, you can force the type of the local block’s unused return value, eg.:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>
<span class="k">var </span><span class="nx">closeLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">line.new</span><span class="p">(</span><span class="ni">bar_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="nx">extend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">extend.right</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="k">if </span><span class="ni">barstate.islast</span><span class="w"></span>
<span class="w">    </span><span class="k">if </span><span class="ni">syminfo.type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"crypto"</span><span class="w"></span>
<span class="w">        </span><span class="ni">line.set_xy1</span><span class="p">(</span><span class="nx">closeLine</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="no">close</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="ni">line.set_xy2</span><span class="p">(</span><span class="nx">closeLine</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="no">close</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="ni">int</span><span class="p">(</span><span class="no">na</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="ni">label.new</span><span class="p">(</span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="no">high</span><span class="p">,</span><span class="w"> </span><span class="s2">"Not a crypto market"</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="ni">int</span><span class="p">(</span><span class="no">na</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we make the return value of each local block <code class="docutils literal notranslate"><span class="pre">int(na)</span></code>,
which is the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>
value, cast to an integer using <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_int">int()</a>.
This way, they both return an “int”, which is not assigned to any variable.
Without these additions to our code, it would not compile.</p>
<a class="reference external image-reference" href="https://www.tradingview.com/"><div align="center" class="align-center"><img alt="../_images/TradingView-Logo-Block.svg" src="../_images/TradingView-Logo-Block.svg" width="200px"/></div>
</a>
</div>
</div>
</div>
<div class="footer-relations">
<div class="pull-left">
<a class="btn btn-default" href="Variable_declarations.html" title="previous chapter (use the left arrow)">Variable declarations</a>
</div>
<div class="pull-right">
<a class="btn btn-default" href="Loops.html" title="next chapter (use the right arrow)">Loops</a>
</div>
</div>
<div class="clearer"></div>
</div>