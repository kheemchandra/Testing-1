<div id="right-column">
<div aria-label="breadcrumbs navigation" role="navigation">
<ol class="breadcrumb">
<li><a href="../index.html">User Manual</a></li>
<li><a href="index.html">Language</a></li>
<li>Loops</li>
</ol>
</div>
<div class="document clearer body">
<a class="reference external image-reference" href="https://www.tradingview.com/pine-script-docs/en/v5/Introduction.html"><div align="right" class="align-right"><img alt="Pine Script™ logo" height="100" src="../_images/Pine_Script_logo.svg" width="100"/></div>
</a>
<div class="section" id="loops">
<span id="pageloops"></span><h1>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id1">Introduction</a><ul>
<li><a class="reference internal" href="#when-loops-are-not-needed" id="id2">When loops are not needed</a></li>
<li><a class="reference internal" href="#when-loops-are-necessary" id="id3">When loops are necessary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#for" id="id4">`for`</a></li>
<li><a class="reference internal" href="#while" id="id5">`while`</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="when-loops-are-not-needed">
<h3><a class="toc-backref" href="#id2">When loops are not needed</a><a class="headerlink" href="#when-loops-are-not-needed" title="Permalink to this headline">¶</a></h3>
<p>Pine Script™’s runtime and its built-in functions make loops unnecessary in many situations.
Budding Pine Script™ programmers not yet familiar with the Pine Script™ runtime and built-ins
who want to calculate the average of the last 10
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_close">close</a> values will often write code such as:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"Inefficient MA"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>
<span class="nx">MA_LENGTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="nx">sumOfCloses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="mf">.0</span><span class="w"></span>
<span class="k">for </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">MA_LENGTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nx">sumOfCloses</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sumOfCloses</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="no">close</span><span class="o">[</span><span class="nx">offset</span><span class="o">]</span><span class="w"></span>
<span class="nx">inefficientMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sumOfCloses</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">MA_LENGTH</span><span class="w"></span>
<span class="ni">plot</span><span class="p">(</span><span class="nx">inefficientMA</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>A <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_for">for</a>
loop is unnecessary and inefficient to accomplish tasks like this in Pine Script™.
This is how it should be done. This code is shorter <em>and</em> will run much faster
because it does not use a loop and uses the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_ta{dot}sma">ta.sma()</a>
built-in function to accomplish the task:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"Efficient MA"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">)</span><span class="w"></span>
<span class="nx">thePineMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">ta.sma</span><span class="p">(</span><span class="no">close</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="ni">plot</span><span class="p">(</span><span class="nx">thePineMA</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Counting the occurrences of a condition in the last bars is also a task
which beginning Pine Script™ programmers often think must be done with a loop.
To count the number of up bars in the last 10 bars, they will use:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"Inefficient sum"</span><span class="p">)</span><span class="w"></span>
<span class="nx">MA_LENGTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="nx">upBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="mf">.0</span><span class="w"></span>
<span class="k">for </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">MA_LENGTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">if </span><span class="no">close</span><span class="o">[</span><span class="nx">offset</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">open</span><span class="o">[</span><span class="nx">offset</span><span class="o">]</span><span class="w"></span>
<span class="w">        </span><span class="nx">upBars</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">upBars</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="ni">plot</span><span class="p">(</span><span class="nx">upBars</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>The efficient way to write this in Pine Script™ (for the programmer because it saves time,
to achieve the fastest-loading charts, and to share our common resources most equitably),
is to use the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_math{dot}sum">math.sum()</a>
built-in function to accomplish the task:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"Efficient sum"</span><span class="p">)</span><span class="w"></span>
<span class="nx">upBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">math.sum</span><span class="p">(</span><span class="no">close</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">open</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"></span>
<span class="ni">plot</span><span class="p">(</span><span class="nx">upBars</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>What’s happening in there is:</p>
<ul class="simple">
<li>We use the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_{question}{colon}">?:</a>
ternary operator to build an expression that yields 1 on up bars and 0 on other bars.</li>
<li>We use the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_math{dot}sum">math.sum()</a>
built-in function to keep a running sum of that value for the last 10 bars.</li>
</ul>
</div>
<div class="section" id="when-loops-are-necessary">
<h3><a class="toc-backref" href="#id3">When loops are necessary</a><a class="headerlink" href="#when-loops-are-necessary" title="Permalink to this headline">¶</a></h3>
<p>Loops exist for good reason because even in Pine Script™, they are necessary in some cases.
These cases typically include:</p>
<ul class="simple">
<li>The manipulation of arrays.</li>
<li>Looking back in history to analyze bars using a reference value that can only
be known on the current bar, e.g., to find how many past highs are higher than the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> of the current bar.
Since the current bar’s <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a>
is only known on the bar the script is running on,
a loop is necessary to go back in time and analyze past bars.</li>
<li>Performing calculations on past bars that cannot be accomplished using Pine Script™’s built-in functions,
like the Pearson correlation coefficient.</li>
</ul>
</div>
</div>
<div class="section" id="for">
<span id="pageloops-for"></span><h2><a class="toc-backref" href="#id4">`for`</a><a class="headerlink" href="#for" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_for">for</a>
structure allows the repetitive execution of statements using a counter.
Its syntax is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = ]for &lt;identifier&gt; = &lt;expression&gt; to &lt;expression&gt;[ by &lt;expression&gt;]
    &lt;local_block_loop&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>Parts enclosed in square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) can appear zero or one time, and those enclosed in curly braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>) can appear zero or more times.</li>
<li>&lt;declaration_mode&gt; is the variable’s <a class="reference internal" href="Variable_declarations.html#pagevariabledeclarations-declarationmodes"><span class="std std-ref">declaration mode</span></a></li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable declarations (see <a class="reference internal" href="Type_system.html#pagetypesystem-types"><span class="std std-ref">types</span></a>)</li>
<li>&lt;identifier&gt; is a variable’s <a class="reference internal" href="Identifiers.html#pageidentifiers"><span class="std std-ref">name</span></a></li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a function call.</li>
<li>&lt;local_block_loop&gt; consists of zero or more statements followed by a return value, which can be a tuple of values.
It must be indented by four spaces or a tab. It can contain the <code class="docutils literal notranslate"><span class="pre">break</span></code> statement to exit the loop,
or the <code class="docutils literal notranslate"><span class="pre">continue</span></code> statement to exit the current iteration and continue on with the next.</li>
<li>The value assigned to the variable is the return value of the &lt;local_block_loop&gt;,
i.e., the last value calculated on the loop’s last iteration,
or <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> if the loop is not executed.</li>
<li>The identifier in <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">&lt;identifier&gt;</span></code> is the loop’s counter <em>initial value</em>.</li>
<li>The expression in <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">&lt;expression&gt;</span></code> is the <em>start value</em> of the counter.</li>
<li>The expression in <code class="docutils literal notranslate"><span class="pre">to</span> <span class="pre">&lt;expression&gt;</span></code> is the <em>end value</em> of the counter. <strong>It is only evaluated upon entry in the loop</strong>.</li>
<li>The expression in <code class="docutils literal notranslate"><span class="pre">by</span> <span class="pre">&lt;expression&gt;</span></code> is optional.
It is the step by which the loop counter is increased or decreased on each iteration of the loop.
Its default value is 1 when <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">value</span> <span class="pre">&lt;</span> <span class="pre">end</span> <span class="pre">value</span></code>. It is -1 when <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">value</span> <span class="pre">&gt;</span> <span class="pre">end</span> <span class="pre">value</span></code>.
The step (+1 or -1) used as the default is determined by the start and end values.</li>
</ul>
<p>This example uses a <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_for">for</a>
statement to look back a user-defined amount of bars to determine how many bars have a
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> that is higher or lower than the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_high">high</a> of the last bar on the chart.
A <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_for">for</a> loop is necessary here,
since the script only has access to the reference value on the chart’s last bar.
Pine Script™’s runtime cannot, here, be used to calculate on the fly, as the script is executing bar to bar:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"`for` loop"</span><span class="p">)</span><span class="w"></span>
<span class="nx">lookbackInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="s2">"Lookback in bars"</span><span class="p">,</span><span class="w"> </span><span class="nx">minval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">maxval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4999</span><span class="p">)</span><span class="w"></span>
<span class="nx">higherBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="nx">lowerBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="k">if </span><span class="ni">barstate.islast</span><span class="w"></span>
<span class="w">    </span><span class="k">var label </span><span class="nx">lbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">label.new</span><span class="p">(</span><span class="no">na</span><span class="p">,</span><span class="w"> </span><span class="no">na</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">label.style_label_left</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">lookbackInput</span><span class="w"></span>
<span class="w">        </span><span class="k">if </span><span class="no">high</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">high</span><span class="w"></span>
<span class="w">            </span><span class="nx">higherBars</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="k">else if </span><span class="no">high</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">high</span><span class="w"></span>
<span class="w">            </span><span class="nx">lowerBars</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="ni">label.set_xy</span><span class="p">(</span><span class="nx">lbl</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="no">high</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">label.set_text</span><span class="p">(</span><span class="nx">lbl</span><span class="p">,</span><span class="w"> </span><span class="ni">str.tostring</span><span class="p">(</span><span class="nx">higherBars</span><span class="p">,</span><span class="w"> </span><span class="s2">"# higher bars\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ni">str.tostring</span><span class="p">(</span><span class="nx">lowerBars</span><span class="p">,</span><span class="w"> </span><span class="s2">"# lower bars"</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<p>This example uses a loop in its <code class="docutils literal notranslate"><span class="pre">checkLinesForBreaches()</span></code> function
to go through an array of pivot lines and delete them when price crosses them.
A loop is necessary here because all the lines in each of the <code class="docutils literal notranslate"><span class="pre">hiPivotLines</span></code> and <code class="docutils literal notranslate"><span class="pre">loPivotLines</span></code>
arrays must be checked on each bar, and there is no Pine Script™ built-in that can do this for us:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="nx">MAX_LINES_COUNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"Pivot line breaches"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">true</span><span class="p">,</span><span class="w"> </span><span class="nx">max_lines_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MAX_LINES_COUNT</span><span class="p">)</span><span class="w"></span>

<span class="k">color </span><span class="nx">hiPivotColorInput</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="ni">input</span><span class="p">(</span><span class="ni">color.new</span><span class="p">(</span><span class="ni">color.lime</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s2">"High pivots"</span><span class="p">)</span><span class="w"></span>
<span class="k">color </span><span class="nx">loPivotColorInput</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="ni">input</span><span class="p">(</span><span class="ni">color.new</span><span class="p">(</span><span class="ni">color.fuchsia</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s2">"Low pivots"</span><span class="p">)</span><span class="w"></span>
<span class="k">int </span><span class="w">  </span><span class="nx">pivotLegsInput</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s2">"Pivot legs"</span><span class="p">)</span><span class="w"></span>
<span class="k">int </span><span class="w">  </span><span class="nx">qtyOfPivotsInput</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="s2">"Quantity of last pivots to remember"</span><span class="p">,</span><span class="w"> </span><span class="nx">minval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">maxval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MAX_LINES_COUNT</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="k">int </span><span class="w">  </span><span class="nx">maxLineLengthInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="s2">"Maximum line length in bars"</span><span class="p">,</span><span class="w"> </span><span class="nx">minval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="c">// ————— Queues a new element in an array and de-queues its first element.</span><span class="w"></span>
<span class="nx">qDq</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span><span class="w"> </span><span class="nx">qtyOfElements</span><span class="p">,</span><span class="w"> </span><span class="nx">arrayElement</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"></span>
<span class="w">    </span><span class="ni">array.push</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span><span class="w"> </span><span class="nx">arrayElement</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if </span><span class="ni">array.size</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">qtyOfElements</span><span class="w"></span>
<span class="w">        </span><span class="c">// Only deqeue if array has reached capacity.</span><span class="w"></span>
<span class="w">        </span><span class="ni">array.shift</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span><span class="w"></span>

<span class="c">// —————— Loop through an array of lines, extending those that price has not crossed and deleting those crossed.</span><span class="w"></span>
<span class="nx">checkLinesForBreaches</span><span class="p">(</span><span class="nx">arrayOfLines</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">int </span><span class="nx">qtyOfLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">array.size</span><span class="p">(</span><span class="nx">arrayOfLines</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">// Don't loop in case there are no lines to check because "to" value will be `na` then`.</span><span class="w"></span>
<span class="w">    </span><span class="k">for </span><span class="nx">lineNo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="p">(</span><span class="nx">qtyOfLines</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">qtyOfLines</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="no">na</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="c">// Need to check that array size still warrants a loop because we may have deleted array elements in the loop.</span><span class="w"></span>
<span class="w">        </span><span class="k">if </span><span class="nx">lineNo</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="ni">array.size</span><span class="p">(</span><span class="nx">arrayOfLines</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">line </span><span class="w"> </span><span class="nx">currentLine</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ni">array.get</span><span class="p">(</span><span class="nx">arrayOfLines</span><span class="p">,</span><span class="w"> </span><span class="nx">lineNo</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">float </span><span class="nx">lineLevel</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="ni">line.get_price</span><span class="p">(</span><span class="nx">currentLine</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">bool </span><span class="w"> </span><span class="nx">lineWasCrossed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">math.sign</span><span class="p">(</span><span class="no">close</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lineLevel</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ni">math.sign</span><span class="p">(</span><span class="no">close</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">lineLevel</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">bool </span><span class="w"> </span><span class="nx">lineIsTooLong</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="ni">bar_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ni">line.get_x1</span><span class="p">(</span><span class="nx">currentLine</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxLineLengthInput</span><span class="w"></span>
<span class="w">            </span><span class="k">if </span><span class="nx">lineWasCrossed</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">lineIsTooLong</span><span class="w"></span>
<span class="w">                </span><span class="c">// Line stays on the chart but will no longer be extend on further bars.</span><span class="w"></span>
<span class="w">                </span><span class="ni">array.remove</span><span class="p">(</span><span class="nx">arrayOfLines</span><span class="p">,</span><span class="w"> </span><span class="nx">lineNo</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="c">// Force type of both local blocks to same type.</span><span class="w"></span>
<span class="w">                </span><span class="ni">int</span><span class="p">(</span><span class="no">na</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="ni">line.set_x2</span><span class="p">(</span><span class="nx">currentLine</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="ni">int</span><span class="p">(</span><span class="no">na</span><span class="p">)</span><span class="w"></span>

<span class="c">// Arrays of lines containing non-crossed pivot lines.</span><span class="w"></span>
<span class="k">var </span><span class="ni">line</span><span class="o">[]</span><span class="w"> </span><span class="nx">hiPivotLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">array.new_line</span><span class="p">(</span><span class="nx">qtyOfPivotsInput</span><span class="p">)</span><span class="w"></span>
<span class="k">var </span><span class="ni">line</span><span class="o">[]</span><span class="w"> </span><span class="nx">loPivotLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">array.new_line</span><span class="p">(</span><span class="nx">qtyOfPivotsInput</span><span class="p">)</span><span class="w"></span>

<span class="c">// Detect new pivots.</span><span class="w"></span>
<span class="k">float </span><span class="nx">hiPivot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">ta.pivothigh</span><span class="p">(</span><span class="nx">pivotLegsInput</span><span class="p">,</span><span class="w"> </span><span class="nx">pivotLegsInput</span><span class="p">)</span><span class="w"></span>
<span class="k">float </span><span class="nx">loPivot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">ta.pivotlow</span><span class="p">(</span><span class="nx">pivotLegsInput</span><span class="p">,</span><span class="w"> </span><span class="nx">pivotLegsInput</span><span class="p">)</span><span class="w"></span>

<span class="c">// Create new lines on new pivots.</span><span class="w"></span>
<span class="k">if </span><span class="nx">not</span><span class="w"> </span><span class="no">na</span><span class="p">(</span><span class="nx">hiPivot</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">line </span><span class="nx">newLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">line.new</span><span class="p">(</span><span class="ni">bar_index</span><span class="o">[</span><span class="nx">pivotLegsInput</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nx">hiPivot</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="nx">hiPivot</span><span class="p">,</span><span class="w"> </span><span class="k">color </span><span class="o">=</span><span class="w"> </span><span class="nx">hiPivotColorInput</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">line.delete</span><span class="p">(</span><span class="nx">qDq</span><span class="p">(</span><span class="nx">hiPivotLines</span><span class="p">,</span><span class="w"> </span><span class="nx">qtyOfPivotsInput</span><span class="p">,</span><span class="w"> </span><span class="nx">newLine</span><span class="p">))</span><span class="w"></span>
<span class="k">else if </span><span class="nx">not</span><span class="w"> </span><span class="no">na</span><span class="p">(</span><span class="nx">loPivot</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">line </span><span class="nx">newLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">line.new</span><span class="p">(</span><span class="ni">bar_index</span><span class="o">[</span><span class="nx">pivotLegsInput</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nx">loPivot</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="nx">loPivot</span><span class="p">,</span><span class="w"> </span><span class="k">color </span><span class="o">=</span><span class="w"> </span><span class="nx">loPivotColorInput</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">line.delete</span><span class="p">(</span><span class="nx">qDq</span><span class="p">(</span><span class="nx">loPivotLines</span><span class="p">,</span><span class="w"> </span><span class="nx">qtyOfPivotsInput</span><span class="p">,</span><span class="w"> </span><span class="nx">newLine</span><span class="p">))</span><span class="w"></span>

<span class="c">// Extend lines if they haven't been crossed by price.</span><span class="w"></span>
<span class="nx">checkLinesForBreaches</span><span class="p">(</span><span class="nx">hiPivotLines</span><span class="p">)</span><span class="w"></span>
<span class="nx">checkLinesForBreaches</span><span class="p">(</span><span class="nx">loPivotLines</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="while">
<span id="pageloops-while"></span><h2><a class="toc-backref" href="#id5">`while`</a><a class="headerlink" href="#while" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a>
structure allows the repetitive execution of statements until a condition is false.
Its syntax is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[[&lt;declaration_mode&gt;] [&lt;type&gt;] &lt;identifier&gt; = ]while &lt;expression&gt;
    &lt;local_block_loop&gt;
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>Parts enclosed in square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) can appear zero or one time.</li>
<li>&lt;declaration_mode&gt; is the variable’s <a class="reference internal" href="Variable_declarations.html#pagevariabledeclarations-declarationmodes"><span class="std std-ref">declaration mode</span></a></li>
<li>&lt;type&gt; is optional, as in almost all Pine Script™ variable declarations (see <a class="reference internal" href="Type_system.html#pagetypesystem-types"><span class="std std-ref">types</span></a>)</li>
<li>&lt;identifier&gt; is a variable’s <a class="reference internal" href="Identifiers.html#pageidentifiers"><span class="std std-ref">name</span></a></li>
<li>&lt;expression&gt; can be a literal, a variable, an expression or a function call.
It is evaluated at each iteration of the loop. When it evaluates to <code class="docutils literal notranslate"><span class="pre">true</span></code>,
the loop executes. When it evaluates to <code class="docutils literal notranslate"><span class="pre">false</span></code> the loop stops.</li>
<li>&lt;local_block_loop&gt; consists of zero or more statements followed by a return value, which can be a tuple of values.
It must be indented by four spaces or a tab. It can contain the <code class="docutils literal notranslate"><span class="pre">break</span></code> statement to exit the loop,
or the <code class="docutils literal notranslate"><span class="pre">continue</span></code> statement to exit the current iteration and continue on with the next.</li>
<li>The value assigned to the &lt;identifier&gt; variable is the return value of the &lt;local_block_loop&gt;,
i.e., the last value calculated on the loop’s last iteration,
or <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a> if the loop is not executed.</li>
</ul>
<p>This is the first code example of the <a class="reference internal" href="#pageloops-for"><span class="std std-ref">for</span></a> section written using a
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a> structure instead of a
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_for">for</a> one:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">"`for` loop"</span><span class="p">)</span><span class="w"></span>
<span class="nx">lookbackInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="s2">"Lookback in bars"</span><span class="p">,</span><span class="w"> </span><span class="nx">minval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nx">maxval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4999</span><span class="p">)</span><span class="w"></span>
<span class="nx">higherBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="nx">lowerBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="k">if </span><span class="ni">barstate.islast</span><span class="w"></span>
<span class="w">    </span><span class="k">var label </span><span class="nx">lbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">label.new</span><span class="p">(</span><span class="no">na</span><span class="p">,</span><span class="w"> </span><span class="no">na</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="nx">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">label.style_label_left</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">// Initialize the loop counter to its start value.</span><span class="w"></span>
<span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="c">// Loop until the `i` counter's value is &lt;= the `lookbackInput` value.</span><span class="w"></span>
<span class="w">    </span><span class="k">while </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">lookbackInput</span><span class="w"></span>
<span class="w">        </span><span class="k">if </span><span class="no">high</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="no">high</span><span class="w"></span>
<span class="w">            </span><span class="nx">higherBars</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="k">else if </span><span class="no">high</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="no">high</span><span class="w"></span>
<span class="w">            </span><span class="nx">lowerBars</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="c">// Counter must be managed "manually".</span><span class="w"></span>
<span class="w">        </span><span class="nx">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="ni">label.set_xy</span><span class="p">(</span><span class="nx">lbl</span><span class="p">,</span><span class="w"> </span><span class="ni">bar_index</span><span class="p">,</span><span class="w"> </span><span class="no">high</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="ni">label.set_text</span><span class="p">(</span><span class="nx">lbl</span><span class="p">,</span><span class="w"> </span><span class="ni">str.tostring</span><span class="p">(</span><span class="nx">higherBars</span><span class="p">,</span><span class="w"> </span><span class="s2">"# higher bars\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ni">str.tostring</span><span class="p">(</span><span class="nx">lowerBars</span><span class="p">,</span><span class="w"> </span><span class="s2">"# lower bars"</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<p>Note that:</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">i</span></code> counter must be incremented by one explicitly inside the
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a>’s local block.</li>
<li>We use the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_{plus}=">+=</a>
operator to add one to the counter. <code class="docutils literal notranslate"><span class="pre">lowerBars</span> <span class="pre">+=</span> <span class="pre">1</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">lowerBars</span> <span class="pre">:=</span> <span class="pre">lowerBars</span> <span class="pre">+</span> <span class="pre">1</span></code>.</li>
</ul>
<p>Let’s calculate the factorial function using a
<a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a> structure:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="c">//@version=5</span><span class="w"></span>
<span class="ni">indicator</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w"></span>
<span class="k">int </span><span class="nx">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ni">input.int</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"Factorial of"</span><span class="p">,</span><span class="w"> </span><span class="nx">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="nx">factorial</span><span class="p">(</span><span class="k">int </span><span class="nx">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">na</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"></span>
<span class="w">    </span><span class="k">int </span><span class="nx">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">val</span><span class="w"></span>
<span class="w">    </span><span class="k">int </span><span class="nx">fact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">while </span><span class="nx">counter</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="nx">fact</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fact</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">counter</span><span class="w"></span>
<span class="w">        </span><span class="nx">counter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="nx">fact</span><span class="w"></span>

<span class="c">// Only evaluate the function on the first bar.</span><span class="w"></span>
<span class="k">var </span><span class="nx">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">factorial</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="w"></span>
<span class="ni">plot</span><span class="p">(</span><span class="nx">answer</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>Note that:</p>
<ul>
<li><p class="first">We use <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_input{dot}int">input.int()</a>
for our input because we need to specify a <code class="docutils literal notranslate"><span class="pre">minval</span></code> value to protect our code.
While <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#fun_input">input()</a>
also supports the input of “int” type values, it does not support the <code class="docutils literal notranslate"><span class="pre">minval</span></code> parameter.</p>
</li>
<li><p class="first">We have packaged our script’s functionality in a <code class="docutils literal notranslate"><span class="pre">factorial()</span></code> function which accepts as an argument
the value whose factorial it must calculate. We have used <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">val</span> <span class="pre">=</span> <span class="pre">na</span></code> to declare our function’s parameter,
which says that if the function is called without an argument, as in <code class="docutils literal notranslate"><span class="pre">factorial()</span></code>,
then the <code class="docutils literal notranslate"><span class="pre">val</span></code> parameter will initialize to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>,
which will prevent the execution of the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a> loop
because its <code class="docutils literal notranslate"><span class="pre">counter</span> <span class="pre">&gt;</span> <span class="pre">0</span></code> expression will return <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.
The <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a> structure will thus
initialize the <code class="docutils literal notranslate"><span class="pre">result</span></code> variable to <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.
In turn, because the initialization of <code class="docutils literal notranslate"><span class="pre">result</span></code> is the return value of the our function’s local block,
the function will return <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#var_na">na</a>.</p>
</li>
<li><p class="first">Note the last line of the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a>’s local block: <code class="docutils literal notranslate"><span class="pre">fact</span></code>.
It is the local block’s return value, so the value it had on the <a class="reference external" href="https://www.tradingview.com/pine-script-reference/v5/#op_while">while</a>
structure’s last iteration.</p>
</li>
<li><p class="first">Our initialization of <code class="docutils literal notranslate"><span class="pre">result</span></code> is not required; we do it for readability. We could just as well have used:</p>
<div class="highlight-pine notranslate"><div class="highlight"><pre><span></span><span class="k">while </span><span class="nx">counter</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="nx">fact</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fact</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">counter</span><span class="w"></span>
<span class="w">    </span><span class="nx">counter</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">counter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nx">fact</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
<a class="reference external image-reference" href="https://www.tradingview.com/"><div align="center" class="align-center"><img alt="../_images/TradingView-Logo-Block.svg" src="../_images/TradingView-Logo-Block.svg" width="200px"/></div>
</a>
</div>
</div>
</div>
<div class="footer-relations">
<div class="pull-left">
<a class="btn btn-default" href="Conditional_structures.html" title="previous chapter (use the left arrow)">Conditional structures</a>
</div>
<div class="pull-right">
<a class="btn btn-default" href="Type_system.html" title="next chapter (use the right arrow)">Type system</a>
</div>
</div>
<div class="clearer"></div>
</div>